package Motors;

import ch.ntb.inf.deep.runtime.ppc32.Task;
import ch.ntb.inf.deep.runtime.mpc555.driver.TPU_PWM;
import definitions.PinMap;
import definitions.RobotConstants;

/*
 * <h1>Class Motor</h1> implements methods to control the speed of
 * a locked-antiphase driven motor.
 */
public class Motor
{

	private TPU_PWM pwmPlus = null;
	private int hightimePWM = 0;
	
	public Motor(boolean useTPUAPlus, int channelAPlus)
	{
		pwmPlus = new TPU_PWM(useTPUAPlus, channelAPlus, RobotConstants.PERIOD_PWM, RobotConstants.PERIOD_PWM / 2);
	}
	
	/**
	 * Method setSpeed() calculates the correct hightime for the given speed.
	 * Speed can vary from +231.5 mm/s to -231.5 mm/s.
	 */
	public void  setSpeed(double speed){
		hightimePWM = (int)((speed / (RobotConstants.MAX_SPEED * 2) + 0.5) * RobotConstants.PERIOD_PWM);
		
		if(hightimePWM > RobotConstants.PERIOD_PWM){
			setFullSpeedForward();
		}
		
		if(hightimePWM < 0){
			setFullSpeedReverse();
		}
	}
	
	public void setStop(){
		hightimePWM = RobotConstants.PERIOD_PWM / 2;
		updatePWM();
	}
	
	public void setFullSpeedForward(){
		hightimePWM = RobotConstants.PERIOD_PWM;
		updatePWM();
	}
	
	public void setHalfSpeedForward(){
		hightimePWM = RobotConstants.PERIOD_PWM * 3/4;
		updatePWM();
	}
	
	public void setFullSpeedReverse(){
		hightimePWM = 0;
		updatePWM();
	}
	
	public void setHalfSpeedReverse(){
		hightimePWM = RobotConstants.PERIOD_PWM * 1/4;
		updatePWM();
	}
	
	public void setHightime(double hightime){
		if(hightime > RobotConstants.PERIOD_PWM){
			hightime = RobotConstants.PERIOD_PWM;
		}
		hightimePWM = (int)hightime;
		updatePWM();
	}
	
	public void updatePWM(){
		pwmPlus.update(hightimePWM);
	}
}
