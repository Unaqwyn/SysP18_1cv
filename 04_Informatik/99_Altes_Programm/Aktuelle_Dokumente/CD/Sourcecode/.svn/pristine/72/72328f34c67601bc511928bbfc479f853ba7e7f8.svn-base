package Communication;

import java.io.PrintStream;
import ch.ntb.inf.deep.runtime.mpc555.driver.MPIOSM_DIO;
import ch.ntb.inf.deep.runtime.mpc555.driver.RN131;
import ch.ntb.inf.deep.runtime.mpc555.driver.SCI;
import ch.ntb.inf.deep.runtime.ppc32.Task;
import ch.ntb.inf.deep.runtime.util.CmdInt;

/**
* <h1>Communication</h1>
* In this class will signals be sent and received.
* <p>
*
* @author  Janick Hartmann
* @version 0.2
* @since   2017-03-07
*/

public class Communication {
	/**
	* The variables of the class Communication.
	* 
	*/	
	private static RN131 wifi;
	int heartbeat = 0;
	final int resetPin = 11;
	
	/**
	* The constructor of the class Communication.
	* 
	*/
	public Communication() throws Exception{		
		SCI sci2 = SCI.getInstance(SCI.pSCI2);
		sci2.start(115200, SCI.NO_PARITY, (short)8);
		wifi = new RN131(sci2.in, sci2.out, new MPIOSM_DIO(resetPin, true));
		
		SCI sci1 = SCI.getInstance(SCI.pSCI1);
		sci1.start(19200, SCI.NO_PARITY, (short)8);
		System.out = new PrintStream(sci1.out);
	}
	
	/**
	* This method sends data to the other robot.
	* 
	* @param sendData: Code that will be sent to the other robot.
	*/
	public static void sendData(int sendData)
	{
		if(wifi.connected()){
			wifi.cmd.writeCmd(sendData);
			System.out.print("\t(Die Nachricht wurde geschickt)\t");
		}
		else{
			System.out.print("\t(Nicht verbunden - Nachricht konnte nicht geschickt werden)\t");
		}			
	}
	
	/**
	* This method receive data from the other robot.
	* 
	*/
	public int getData()
	{
		if(wifi.connected()){
			return wifi.cmd.getInt();
		}
		else{
			return 99;
		}
	}
	
	/**
	* This method changes the value of the variable heartbeat.
	* 
	*/
	public int changeHeartbeat()
	{
		if (heartbeat == 0){
			heartbeat = 1;
		}
		else{
			heartbeat = 0;
		}
		return heartbeat;
	}
	
	/**
	* This method checks the received heartbeat.
	* 
	*/
	public boolean getHeartbeat()
	{
		if (getData() == 0 && heartbeat == 1){
			return true;
		}
		else if (getData() == 1 && heartbeat == 0){
			
			return true;
		}
		else{
			return false;
		}
	}
}
